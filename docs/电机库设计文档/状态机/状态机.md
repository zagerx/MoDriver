# fsm 设计规范

## 目标

* 提供确定性、可抢占、非阻塞的有限状态机框架
* 适用于电机控制等强实时场景

## 基本原则

1. 状态函数返回 void
2. 状态函数必须非阻塞、可重入
3. 禁止在状态函数中使用死循环、延时等待
4. 状态切换只能通过框架接口完成

## state / phase 模型

* state 表示宏观状态
* phase 表示同一 state 内的执行阶段
* phase 不是子状态机

## phase 规则

* 框架只定义 enter / exit
* 用户可扩展 phase
* 用户 phase 必须 >= FSM_PHASE_RUN
* 任何 phase 下不允许阻塞

## 公共状态（global state）

* global state 具有最高优先级
* dispatch 时优先执行 global state
* global state 也遵循 enter / exit 规则

## 使用约束

* enter / exit 只做一次性工作
* 运行逻辑必须放在用户 phase 中
* 禁止在外部直接修改 phase

---